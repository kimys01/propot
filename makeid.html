<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Propot 회원가입</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary-color: #6a5acd;
    --button-hover-color: #5a4ab9;
    --background-color: #f0f2f5;
    --container-bg-color: #ffffff;
    --text-color: #333;
    --text-muted-color: #666;
    --border-color: #e0e0e0;
    --error-color: #d93025;
  }
  body {
    margin: 0;
    background: var(--background-color);
    color: var(--text-color);
    font-family: 'Noto Sans KR', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px 0;
  }
  .signup-container {
    background: var(--container-bg-color);
    padding: 40px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    text-align: center;
    width: 100%;
    max-width: 400px;
  }
  .logo {
    font-size: 28px;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 10px;
  }
  p {
    color: var(--text-muted-color);
    margin-bottom: 30px;
  }
  .input-field {
    width: 100%;
    padding: 12px 14px;
    margin-bottom: 15px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 16px;
    box-sizing: border-box;
    transition: all 0.2s;
  }
  .input-field:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(106, 90, 205, 0.2);
  }
  .btn {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-primary {
    background-color: var(--primary-color);
    color: white;
  }
  .btn-primary:hover {
    background-color: var(--button-hover-color);
  }
  .error-message {
    color: var(--error-color);
    font-size: 14px;
    margin-bottom: 15px;
    height: 20px; /* 에러 메시지 공간 확보 */
  }
  .login-link {
    margin-top: 20px;
    display: block;
    color: var(--text-muted-color);
    font-size: 14px;
  }
  .login-link a {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 500;
  }
  .login-link a:hover {
    text-decoration: underline;
  }
  /* --- 직무 선택 스타일 추가 --- */
  .job-selection-container {
    text-align: left;
    margin-bottom: 20px;
  }
  .job-selection-container h4 {
    margin: 0 0 10px 0;
    font-weight: 500;
    color: var(--text-color);
    font-size: 16px;
  }
  .job-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  .job-option {
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
  }
  .job-option:hover {
    background-color: #f7f7f7;
    border-color: #ccc;
  }
  .job-option.selected {
    border-color: var(--primary-color);
    background-color: rgba(106, 90, 205, 0.05);
    color: var(--primary-color);
    font-weight: 500;
  }
  .job-option .icon {
      font-size: 20px;
  }
</style>
</head>
<body>
  <div class="signup-container">
    <div class="logo">📁 Propot</div>
    <p>새로운 계정을 만들어 시작해보세요.</p>

    <div id="error-message" class="error-message"></div>

    <input type="text" id="displayName" class="input-field" placeholder="이름 (닉네임)" required />
    <input type="email" id="email" class="input-field" placeholder="이메일" required />
    <input type="password" id="password" class="input-field" placeholder="비밀번호 (6자 이상)" required />
    <input type="password" id="password-confirm" class="input-field" placeholder="비밀번호 확인" required />
    
    <!-- 직무 선택 섹션 추가 -->
    <div class="job-selection-container">
        <h4>어떤 일을 하시나요? (중복선택 가능)</h4>
        <div class="job-options">
            <div class="job-option" data-job="designer">
                <span class="icon">🎨</span>
                <span>디자이너</span>
            </div>
            <div class="job-option" data-job="developer">
                <span class="icon">💻</span>
                <span>개발자</span>
            </div>
            <div class="job-option" data-job="creator">
                <span class="icon">🎬</span>
                <span>영상 제작자</span>
            </div>
            <div class="job-option" data-job="writer">
                <span class="icon">✍️</span>
                <span>작가/기획자</span>
            </div>
        </div>
    </div>

    <button id="btn-signup" class="btn btn-primary">회원가입</button>

    <div class="login-link">
      이미 계정이 있으신가요? <a href="login.html">로그인</a>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig={apiKey:"AIzaSyBofsqFmPSvocB0cBU8Azj-nMDWTB_of00",authDomain:"propot-cc6bf.firebaseapp.com",projectId:"propot-cc6bf",appId:"1:30940698980:web:1729f30e68d3beb24ac271"};
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore(); // Firestore 초기화

    const $ = s => document.querySelector(s);
    const displayNameInput = $('#displayName');
    const emailInput = $('#email');
    const passwordInput = $('#password');
    const passwordConfirmInput = $('#password-confirm');
    const errorDiv = $('#error-message');

    // --- 직무 선택 로직 수정 (중복선택 가능) ---
    const jobOptions = document.querySelectorAll('.job-option');
    let selectedJobs = []; // 배열로 변경
    jobOptions.forEach(option => {
        option.addEventListener('click', () => {
            option.classList.toggle('selected'); // 선택/해제 토글
            const job = option.dataset.job;
            if (option.classList.contains('selected')) {
                selectedJobs.push(job); // 배열에 추가
            } else {
                selectedJobs = selectedJobs.filter(j => j !== job); // 배열에서 제거
            }
        });
    });

    $('#btn-signup').onclick = () => {
      const displayName = displayNameInput.value.trim();
      const email = emailInput.value;
      const password = passwordInput.value;
      const passwordConfirm = passwordConfirmInput.value;
      errorDiv.textContent = '';

      if (!displayName || !email || !password || !passwordConfirm) {
        errorDiv.textContent = '모든 항목을 입력해주세요.';
        return;
      }
      if (password !== passwordConfirm) {
        errorDiv.textContent = '비밀번호가 일치하지 않습니다.';
        return;
      }
      if (password.length < 6) {
        errorDiv.textContent = '비밀번호는 6자 이상이어야 합니다.';
        return;
      }
      if (selectedJobs.length === 0) { // 배열 길이 확인으로 변경
        errorDiv.textContent = '하나 이상의 관련 직무를 선택해주세요.';
        return;
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          const user = userCredential.user;
          // 1. Auth 프로필 업데이트
          return user.updateProfile({
            displayName: displayName
          }).then(() => {
            // 2. Firestore에 사용자 정보 저장
            const userRef = db.collection('users').doc(user.uid);
            const lowerEmail = (user.email || '').trim().toLowerCase();
            return userRef.set({
                uid: user.uid,
                displayName: displayName,
                email: user.email || null,
                emailLower: lowerEmail,
                photoURL: user.photoURL || null,
                jobRole: selectedJobs, // 선택한 직무 정보 (배열) 저장
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            });
          }).then(() => {
            // 3. 모든 작업 완료 후 리디렉션
            location.href = 'index.html';
          });
        })
        .catch(error => {
          console.error("Signup failed:", error);
          switch (error.code) {
            case 'auth/email-already-in-use':
              errorDiv.textContent = '이미 사용 중인 이메일입니다.';
              break;
            case 'auth/weak-password':
              errorDiv.textContent = '비밀번호는 6자 이상이어야 합니다.';
              break;
            case 'auth/invalid-email':
              errorDiv.textContent = '올바른 이메일 형식이 아닙니다.';
              break;
            default:
              errorDiv.textContent = '회원가입 중 오류가 발생했습니다.';
          }
        });
    };
  </script>
</body>
</html>

