<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Propot íšŒì›ê°€ì…</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary-color: #6a5acd;
    --button-hover-color: #5a4ab9;
    --background-color: #f0f2f5;
    --container-bg-color: #ffffff;
    --text-color: #333;
    --text-muted-color: #666;
    --border-color: #e0e0e0;
    --error-color: #d93025;
  }
  body {
    margin: 0;
    background: var(--background-color);
    color: var(--text-color);
    font-family: 'Noto Sans KR', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 20px 0;
  }
  .signup-container {
    background: var(--container-bg-color);
    padding: 40px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    text-align: center;
    width: 100%;
    max-width: 400px;
  }
  .logo {
    font-size: 28px;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 10px;
  }
  p {
    color: var(--text-muted-color);
    margin-bottom: 30px;
  }
  .input-field {
    width: 100%;
    padding: 12px 14px;
    margin-bottom: 15px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 16px;
    box-sizing: border-box;
    transition: all 0.2s;
  }
  .input-field:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(106, 90, 205, 0.2);
  }
  .btn {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-primary {
    background-color: var(--primary-color);
    color: white;
  }
  .btn-primary:hover {
    background-color: var(--button-hover-color);
  }
  .error-message {
    color: var(--error-color);
    font-size: 14px;
    margin-bottom: 15px;
    height: 20px; /* ì—ëŸ¬ ë©”ì‹œì§€ ê³µê°„ í™•ë³´ */
  }
  .login-link {
    margin-top: 20px;
    display: block;
    color: var(--text-muted-color);
    font-size: 14px;
  }
  .login-link a {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 500;
  }
  .login-link a:hover {
    text-decoration: underline;
  }
  /* --- ì§ë¬´ ì„ íƒ ìŠ¤íƒ€ì¼ ì¶”ê°€ --- */
  .job-selection-container {
    text-align: left;
    margin-bottom: 20px;
  }
  .job-selection-container h4 {
    margin: 0 0 10px 0;
    font-weight: 500;
    color: var(--text-color);
    font-size: 16px;
  }
  .job-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  .job-option {
    padding: 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
  }
  .job-option:hover {
    background-color: #f7f7f7;
    border-color: #ccc;
  }
  .job-option.selected {
    border-color: var(--primary-color);
    background-color: rgba(106, 90, 205, 0.05);
    color: var(--primary-color);
    font-weight: 500;
  }
  .job-option .icon {
      font-size: 20px;
  }
</style>
</head>
<body>
  <div class="signup-container">
    <div class="logo">ğŸ“ Propot</div>
    <p>ìƒˆë¡œìš´ ê³„ì •ì„ ë§Œë“¤ì–´ ì‹œì‘í•´ë³´ì„¸ìš”.</p>

    <div id="error-message" class="error-message"></div>

    <input type="text" id="displayName" class="input-field" placeholder="ì´ë¦„ (ë‹‰ë„¤ì„)" required />
    <input type="email" id="email" class="input-field" placeholder="ì´ë©”ì¼" required />
    <input type="password" id="password" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)" required />
    <input type="password" id="password-confirm" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required />
    
    <!-- ì§ë¬´ ì„ íƒ ì„¹ì…˜ -->
    <div class="job-selection-container">
        <h4>ì–´ë–¤ ì¼ì„ í•˜ì‹œë‚˜ìš”? (ì¤‘ë³µ ì„ íƒ ê°€ëŠ¥)</h4>
        <div class="job-options">
            <div class="job-option" data-job="designer">
                <span class="icon">ğŸ¨</span>
                <span>ë””ìì´ë„ˆ</span>
            </div>
            <div class="job-option" data-job="developer">
                <span class="icon">ğŸ’»</span>
                <span>ê°œë°œì</span>
            </div>
            <div class="job-option" data-job="creator">
                <span class="icon">ğŸ¬</span>
                <span>ì˜ìƒ ì œì‘ì</span>
            </div>
            <div class="job-option" data-job="writer">
                <span class="icon">âœï¸</span>
                <span>ì‘ê°€/ê¸°íšì</span>
            </div>
        </div>
    </div>

    <button id="btn-signup" class="btn btn-primary">íšŒì›ê°€ì…í•˜ê³  ì‹œì‘í•˜ê¸°</button>

    <div class="login-link">
      ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="login.html">ë¡œê·¸ì¸</a>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig={apiKey:"AIzaSyBofsqFmPSvocB0cBU8Azj-nMDWTB_of00",authDomain:"propot-cc6bf.firebaseapp.com",projectId:"propot-cc6bf",appId:"1:30940698980:web:1729f30e68d3beb24ac271"};
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const $ = s => document.querySelector(s);
    const displayNameInput = $('#displayName');
    const emailInput = $('#email');
    const passwordInput = $('#password');
    const passwordConfirmInput = $('#password-confirm');
    const errorDiv = $('#error-message');

    // ì§ë¬´ ì¤‘ë³µ ì„ íƒ ë¡œì§
    const jobOptions = document.querySelectorAll('.job-option');
    const selectedJobs = new Set();
    jobOptions.forEach(option => {
        option.addEventListener('click', () => {
            option.classList.toggle('selected');
            const job = option.dataset.job;
            if (selectedJobs.has(job)) {
                selectedJobs.delete(job);
            } else {
                selectedJobs.add(job);
            }
        });
    });

    $('#btn-signup').onclick = () => {
      const displayName = displayNameInput.value.trim();
      const email = emailInput.value;
      const password = passwordInput.value;
      const passwordConfirm = passwordConfirmInput.value;
      errorDiv.textContent = '';

      if (!displayName || !email || !password || !passwordConfirm) {
        return errorDiv.textContent = 'ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
      }
      if (password !== passwordConfirm) {
        return errorDiv.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
      }
      if (password.length < 6) {
        return errorDiv.textContent = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
      }
      if (selectedJobs.size === 0) {
        return errorDiv.textContent = 'í•˜ë‚˜ ì´ìƒì˜ ì§ë¬´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.';
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
          const user = userCredential.user;
          return user.updateProfile({
            displayName: displayName
          }).then(() => {
            const userRef = db.collection('users').doc(user.uid);
            const lowerEmail = (user.email || '').trim().toLowerCase();
            return userRef.set({
                uid: user.uid,
                displayName: displayName,
                email: user.email || null,
                emailLower: lowerEmail,
                photoURL: user.photoURL || null,
                jobRole: Array.from(selectedJobs), // Setì„ ë°°ì—´ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            });
          }).then(() => {
            // --- ìˆ˜ì •ëœ ë¶€ë¶„: ê°€ì… í›„ ìì‹ ì˜ í¬íŠ¸í´ë¦¬ì˜¤ í˜ì´ì§€ë¡œ ë°”ë¡œ ì´ë™ ---
            location.href = `u.html?uid=${user.uid}`;
          });
        })
        .catch(error => {
          console.error("Signup failed:", error);
          switch (error.code) {
            case 'auth/email-already-in-use':
              errorDiv.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.'; break;
            case 'auth/weak-password':
              errorDiv.textContent = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'; break;
            case 'auth/invalid-email':
              errorDiv.textContent = 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.'; break;
            default:
              errorDiv.textContent = 'íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
          }
        });
    };
  </script>
</body>
</html>

